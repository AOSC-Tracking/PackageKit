<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN" "http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd">

<chapter id="signals">
  <title>Signals</title>

  <para>
    Signals used by the backends are as follows:
  </para>
  <sect1 id="signals-percentage">
    <title>Progress</title>
    <para>
      This is optional.
      Backends should send the percentage fields to 101 if the amount complete
      cannot be calculated.
    </para>
    <informaltable>
      <tgroup cols="2">
        <thead>
          <row>
            <entry>Option</entry>
            <entry>Description</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><literal>percentage</literal></entry>
            <entry>The percentage complete of the entire transaction</entry>
          </row>
          <row>
            <entry><literal>subpercentage</literal></entry>
            <entry>The subpercentage complete of the sub-transaction</entry>
          </row>
          <row>
            <entry><literal>elapsed</literal></entry>
            <entry>
              The amount of time in seconds this transaction has been in the
              running state
            </entry>
          </row>
          <row>
            <entry><literal>remaining</literal></entry>
            <entry>
              The amount of time in seconds this transaction will take to
              complete. Zero is sent for unknown.
            </entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
  </sect1>

  <sect1 id="signals-error">
    <title>Error</title>
    <para>
      Errors should only be send on fatal abortion.
    </para>
    <informaltable>
      <tgroup cols="2">
        <thead>
          <row>
            <entry>Option</entry>
            <entry>Description</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><literal>enum</literal></entry>
            <entry>Enumerated type, e.g. <literal>no-network</literal>.</entry>
          </row>
          <row>
            <entry><literal>description</literal></entry>
            <entry>
              Long description or error, e.g.
              <literal>failed to connect to mytry.xml</literal>
            </entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
  </sect1>

  <sect1 id="signals-status">
    <title>Status</title>
    <para>
      This is optional, but highly recommended.
      It gives the GUI tools a chance to show a different icon to show what
      stage the transaction is in, for instance, a downloading icon can be
      shown whilst in the <literal>download</literal> state.
    </para>
    <informaltable>
      <tgroup cols="2">
        <thead>
          <row>
            <entry>Option</entry>
            <entry>Description</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><literal>status</literal></entry>
            <entry>
              One of "<literal>download</literal>",
              "<literal>install</literal>",
              "<literal>update</literal>",
              "<literal>remove</literal>".
            </entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
  </sect1>

  <sect1 id="signals-requirerestart">
    <title>RequireRestart</title>
    <para>
      This is optional, but highly recommended.
    </para>
    <para>
      This can be sent as many times as needed by the backend script.
      PackageKit will always choose the 'worst' method in the UI notification.
    </para>
    <informaltable>
      <tgroup cols="2">
        <thead>
          <row>
            <entry>Option</entry>
            <entry>Description</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><literal>type</literal></entry>
            <entry>
              One of "<literal>system</literal>",
              "<literal>application</literal>",
              "<literal>session</literal>".
            </entry>
          </row>
          <row>
            <entry><literal>detail</literal></entry>
            <entry>Optional details about the restart</entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
  </sect1>

  <sect1 id="signals-message">
    <title>Message</title>
    <para>
      This allows the backend to queue up a message to be shown after the
      transaction has completed.
    </para>
    <informaltable>
      <tgroup cols="2">
        <thead>
          <row>
            <entry>Option</entry>
            <entry>Description</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><literal>type</literal></entry>
            <entry>
              One of "<literal>warning</literal>",
              "<literal>notice</literal>",
              "<literal>daemon</literal>".
            </entry>
          </row>
          <row>
            <entry><literal>detail</literal></entry>
            <entry>Required details about the message, non localised</entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
  </sect1>

  <sect1 id="signals-package">
    <title>Package</title>
    <para>
      If updating, as packages are updated then emit them to the screen.
      This allows a summary to be presented after the transaction.
    </para>
    <para>
      When returning results from a search always return
      <literal>installed</literal> before <literal>available</literal> for
      the same package name.
    </para>
    <informaltable>
      <tgroup cols="2">
        <thead>
          <row>
            <entry>Option</entry>
            <entry>Description</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><literal>info</literal></entry>
            <entry>A valid <literal>info</literal> string enumerated type</entry>
          </row>
          <row>
            <entry><literal>package_id</literal></entry>
            <entry>A valid package ID string with as much data as known</entry>
          </row>
          <row>
            <entry><literal>summary</literal></entry>
            <entry>
              The one line package summary, e.g. "Clipart for OpenOffice"
            </entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>

    <para>
      The <literal>info</literal> enumerated type
    </para>

    <informaltable>
      <tgroup cols="3">
        <thead>
          <row>
            <entry>Situation</entry>
            <entry>Value</entry>
            <entry>Description</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry>Searching</entry>
            <entry><literal>installed</literal></entry>
            <entry>If installed</entry>
          </row>
          <row>
            <entry></entry>
            <entry><literal>available</literal></entry>
            <entry>If available to install</entry>
          </row>
          <row>
            <entry>Getting Updates</entry>
            <entry><literal>low</literal></entry>
            <entry>If update is of low severity</entry>
          </row>
          <row>
            <entry></entry>
            <entry><literal>normal</literal></entry>
            <entry>If update is of normal severity</entry>
          </row>
          <row>
            <entry></entry>
            <entry><literal>important</literal></entry>
            <entry>If update is very important</entry>
          </row>
          <row>
            <entry></entry>
            <entry><literal>security</literal></entry>
            <entry>If the update is security sensitive</entry>
          </row>
          <row>
            <entry>Installing/Updating/Removing</entry>
            <entry><literal>downloading</literal></entry>
            <entry>If we are downloading this package</entry>
          </row>
          <row>
            <entry></entry>
            <entry><literal>updating</literal></entry>
            <entry>If we are updating this package</entry>
          </row>
          <row>
            <entry></entry>
            <entry><literal>installing</literal></entry>
            <entry>If we are installing this package</entry>
          </row>
          <row>
            <entry></entry>
            <entry><literal>removing</literal></entry>
            <entry>If we are removing this package</entry>
          </row>
          <row>
            <entry>Otherwise</entry>
            <entry><literal>unknown</literal></entry>
            <entry>If we cannot use any other option</entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>

  </sect1>

  <sect1 id="signals-details">
    <title>Details</title>
    <informaltable>
      <tgroup cols="2">
        <thead>
          <row>
            <entry>Option</entry>
            <entry>Description</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><literal>package_id</literal></entry>
            <entry>The package ID</entry>
          </row>
          <row>
            <entry><literal>license</literal></entry>
            <entry>
              The license, e.g. "GPLv2+" or "proprietary".
              If you need to add a EULA then do it like this:
              "proprietary;By installing this software\nyou may kill a kitten."
            </entry>
          </row>
          <row>
            <entry><literal>group</literal></entry>
            <entry>The enumerated package group description</entry>
          </row>
          <row>
            <entry><literal>detail</literal></entry>
            <entry>
              The multi-line package description.
              NOTE: Tabs may have to be stripped from the description to
              avoid being split.
            </entry>
          </row>
          <row>
            <entry><literal>url</literal></entry>
            <entry>The upstream project homepage</entry>
          </row>
          <row>
            <entry><literal>size</literal></entry>
            <entry>
              The size of the package in bytes. This should be the
              size of the entire package file, not the size of the
              files installed on the system.
            </entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
  </sect1>

  <sect1 id="signals-update-detail">
    <title>UpdateDetail</title>
    <informaltable>
      <tgroup cols="2">
        <thead>
          <row>
            <entry>Option</entry>
            <entry>Description</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><literal>package_id</literal></entry>
            <entry>The package ID</entry>
          </row>
          <row>
            <entry><literal>updates</literal></entry>
            <entry>A list of package_id's that are to be updated</entry>
          </row>
          <row>
            <entry><literal>obsoletes</literal></entry>
            <entry>A list of package_id's that are to be obsoletes</entry>
          </row>
          <row>
            <entry><literal>vendor_url</literal></entry>
            <entry>
              A URL with more details on the update, e.g. a page with more
              information on the update.
              The format of this command should be
              <literal>http://www.foo.org/page.html?4567;Update to SELinux</literal>
            </entry>
          </row>
          <row>
            <entry><literal>bugzilla_url</literal></entry>
            <entry>
              A bugzilla URL with more details on the update.
              If no URL is available then this field should be left empty.
            </entry>
          </row>
          <row>
            <entry><literal>cve_url</literal></entry>
            <entry>
              A CVE URL with more details on the security advisory
            </entry>
          </row>
          <row>
            <entry><literal>restart_enum</literal></entry>
            <entry>A valid restart type, e.g. "system"</entry>
          </row>
          <row>
            <entry><literal>update_text</literal></entry>
            <entry>
              The update text describing the update in a non-localised way.
              Newlines should be converted to ";" before printed.
            </entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
  </sect1>

  <sect1 id="signals-repo-signature-required">
    <title>RepoSignatureRequired</title>
    <para>
      Some backends support repositories which use a cryptographic
      signature, such as GPG. If a package cannot be installed
      because it is signed with a key that has not been verified,
      this signal is generated so the user can choose to accept or
      decline the key.
    </para>
    <para>
      This signal includes information that can be used to verify
      that the key should be trusted, such as a URL for the company
      or person who owns the key, the key's ID, the userid of
      the key creator, and the date the key was generated.
    </para>
    <informaltable>
      <tgroup cols="2">
        <thead>
          <row>
            <entry>Option</entry>
            <entry>Description</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><literal>package_id</literal></entry>
            <entry>A package ID for the package that is trying to be installed</entry>
          </row>
          <row>
            <entry><literal>repository_name</literal></entry>
            <entry>
              The name of the repository associated with the provided key
            </entry>
          </row>
          <row>
            <entry><literal>key_url</literal></entry>
            <entry>The URL provided with the key.</entry>
          </row>
          <row>
            <entry><literal>key_userid</literal></entry>
            <entry>The user id associated with the key</entry>
          </row>
          <row>
            <entry><literal>key_id</literal></entry>
            <entry>A unique identifier for the key</entry>
          </row>
          <row>
            <entry><literal>key_fingerprint</literal></entry>
            <entry>The hashed fingerprint of the key</entry>
          </row>
          <row>
            <entry><literal>key_timestamp</literal></entry>
            <entry>The date the key was created</entry>
          </row>
          <row>
            <entry><literal>type</literal></entry>
            <entry>The type of signature used. 'GPG', for example.</entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
  </sect1>

  <sect1 id="signals-eula-required">
    <title>EulaRequired</title>
    <para>
      Some backends support EULAs, which have to be agreed to before the install can proceed.
    </para>
    <informaltable>
      <tgroup cols="2">
        <thead>
          <row>
            <entry>Option</entry>
            <entry>Description</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><literal>eula_id</literal></entry>
            <entry>
              The <literal>eula_id</literal> which identifies the EULA - this is provided
              so that if a specific EULA has previously agreed to a EULA from Acme Corp it is
              not asked again.
              An example <literal>eula_id</literal>'s is <literal>vmware5_single_user</literal>.
            </entry>
          </row>
          <row>
            <entry><literal>package_id</literal></entry>
            <entry>A package ID for the package that is trying to be installed</entry>
          </row>
          <row>
            <entry><literal>vendor_name</literal></entry>
            <entry>
              The vendor that is providing the EULA.
            </entry>
          </row>
          <row>
            <entry><literal>license_agreement</literal></entry>
            <entry>The full text EULA.</entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
  </sect1>

</chapter>

