#! /usr/bin/env python
# encoding: utf-8
#
# Copyright (C) 2007 Richard Hughes <richard@hughsie.com>
#
# Licensed under the GNU General Public License Version 2
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.

#Marshall file
libpackagekit = bld.create_obj('gnome', 'shlib')
libpackagekit.add_marshal_file('pk-marshal.list', 'pk_marshal', '--header')
libpackagekit.add_marshal_file('pk-marshal.list', 'pk_marshal', '--body')
libpackagekit.uselib = 'GLIB GOBJECT DBUS DBUS_GLIB'
libpackagekit.add_objects = 'libgbus libselftest'
libpackagekit.source = """
	pk-debug.c
	pk-connection.c
	pk-package-id.c
	pk-package-list.c
	pk-enum-list.c
	pk-enum.c
	pk-common.c
	pk-client.c
	pk-task-list.c
	pk-job-list.c
	pk-polkit-client.c
"""

# libtool versioning - CURRENT.REVISION.AGE
# increment:
# CURRENT	If the API or ABI interface has changed (reset REVISION to 0)
# REVISION	If the API and ABI remains the same, but bugs are fixed.
# AGE		If libpackagekit can be linked into executables which can be
# 		built with previous versions of this library. Don't use.
libpackagekit.vnum = '3.0.0'

env = bld.env()
if env['HAVE_NETWORKMANAGER']:
    libpackagekit.uselib += ' NM_GLIB'
    libpackagekit.source += ' pk-network-nm.c'
else:
    libpackagekit.source += ' pk-network-dummy.c'

libpackagekit.includes      = '. ../libgbus ../libselftest'
libpackagekit.target        = 'packagekit'
libpackagekit.name          = 'libpackagekit'

# install headers to /usr/include/packagekit/
install_files('PREFIX', 'include/packagekit', """
	pk-debug.h
	pk-connection.h
	pk-network.h
	pk-package-id.h
	pk-package-list.h
	pk-enum-list.h
	pk-enum.h
	pk-common.h
	pk-client.h
	pk-task-list.h
	pk-job-list.h
	pk-polkit-client.h
""")

#TODO: do not install this file!!!
if env['HAVE_TESTS']:
	obj = bld.create_obj('cc', 'program')
	obj.source = libpackagekit.source + ' pk-self-test.c'
	obj.uselib = 'GLIB GOBJECT DBUS_GLIB POLKIT_DBUS GTHREAD'
	obj.uselib_local = 'libpackagekit'
	obj.target = 'pk-self-test'
	obj.includes = '. ../libselftest ../libgbus'
